## DNS について

権限を委任しており、各ゾーンに権威 DNS サーバーを置く
example.jp⇨abc.example.jp

- 権威 DNS サーバーの役割はざっくりいうと、ゾーンの中にあるレコードを返すことである
  A レコード：ipv4
  AAAA レコード:ipv6

Route53 でゾーンを作成する

ドメインの各ゾーンを管理する権威 DNS サーバーは 2 つは存在している(はず)

### 名前解決の流れ

クライアント PC からインターネットのどこかへリクエストを投げる際に、そのリクエスト先(DNS: `example.jp`)をまずは、フルサービスリゾルバー(キャッシュ DNS サーバー)へ問い合わせる。自宅だとブロードバンドルーターがその役割を担っていることがほとんどである。
まずはキャッシュ DNS サーバーからルートサーバー(権威 DNS)へ問い合わせを行い、その後わからないので jp に聞けと言われ、jp の DNS サーバーへ問い合わせを行い、最後同様に、example.jp の dns サーバーへ問い合わせを行うといったようにたらい回しにされつつも解決を進めていく。

### 宿題

- CAA レコードとは？
  下記のように書いて、porker.ink の SSL 証明書を取得する際に amazon.com にしか依頼できないようになっている。
  porker.ink IN 0 issue "amazon.com"

1. Route53 と ACM の料金体系について

- Route53<br>
  従量課金制となっている。

  - ホストゾーンの管理として各ホストゾーンに対する月額料金。
  - DNS クエリへの応答として料金が発生。
  - ドメイン名の管理として Route53 経由で登録された各ドメイン・Route53 に転送されたドメイン名に対して年間料金が必要。<br>
    これよくわからん。Value domain で購入したドメインの管理を Route53 で行っている場合、何に対して費用がどれくらいかかる？

- AmazonCertificateManager<Br>
  パブリックな場合は料金はかからないがプライベート CA を利用する場合は費用がかかる。

2. 権威 DNS サーバーとキャッシュ DNS サーバーの違い

- 権威 DNS サーバーはあるゾーンまたはドメインに関する情報をレコードとして保持し、そのドメインに関する問い合わせに対して情報を返却しています。
- キャッシュ DNS サーバーは一度問い合わせされた DNS の情報をキャッシュしておき、同じ問い合わせがきた際にキャッシュした情報を返却することができる。(これによって DNS の応答速度が向上する。)

AWS ではどちらも存在し、Route53 が権威 DNS サーバ、Route53 リゾルバがフルサービスリゾルバ(キャッシュ DNS サーバ)としての役割を果たしている。

3,4. 各コマンドの意味は？
`$ dig porker.ink caa`
これは、porker.ink ドメインの caa レコードに関する問い合わせを行っている。

`$ dig porker.ink caa +norec @m.root-servers.net`
これは、porker.ink ドメインの caa レコードに関する問い合わせをキャッシュ DNS サーバのキャッシュを無視して、ルートサーバへ問い合わせを行っている。
今回この結果、ルートサーバはわからないため、ink.の権威 DNS サーバの情報として NS、A、AAAA レコードを返却した。

`$ dig porker.ink caa +norec @c.nic.ink.`
これは、porker.ink のドメインの caa レコードに関する問い合わせをキャッシュ DNS サーバのキャッシュを無視して、先ほどの結果で出た ink.の権威 DNS サーバへ問い合わせを行っている。今回この結果、porker.ink に関する権威 DNS サーバの NS レコードが得られた。

`$ dig porker.ink caa +norec @ネームサーバのNS`
重複するので簡略に回答する。ここで結論から言うと、上記で得られた権威 DNS サーバに対して(Route53 で管理)、CAA レコードを問い合わせ、
求めている回答が得られた。CAA レコードが返却された。`porker.ink.		3600	IN	CAA	0 issue "amazon.com"`

5. レコードの用途

- SOA<br>
  `ns-634.awsdns-15.net. awsdns-hostmaster.amazon.com. 1 7200 900 1209600 86400`
  当該ゾーンに関する情報を持っているレコードである。
  条きの半角スペースで区切られた 7 つの情報を持っている。
  1 つ目がゾーンファイルの基となるデータを持つネームサーバの名前(プライマリネームサーバ)、ドメインの管理者のメールアドレス、1 はゾーンファイルのバージョン、7200 はリフレッシュ時間を指しており、ゾーン内のレコード情報を取得するためにセカンダリネームサーバがプライマリネームサーバに対して問い合わせを行う感覚のことを指す。この時間感覚でセカンダリがプライマリに対して問い合わせを行い、最新の情報を取得しにいく、900 はリトライ時間でセカンダリネームサーバがプライマリネームサーバからデータを取得できなかった際に再試行するまでの時間であり、1209600 はデータがキャッシュされた後、キャッシュが期限切れになるまでの時間である、86400 はデフォルトの TTL。
- NS<br>
  ゾーン内のネームサーバの名前を指定するレコードであり、ゾーンに対する権威 DNS サーバを指している。
- CAA<br>
  DNS レコードで認証局(CA)に証明書を発行する前に特定のドメインに対して証明書を発行できる CA を指定するために使用される。
- A
  ipv4 の ip アドレスをドメイン名に関連づけるために使用されるレコードである。
- AAAA
  ipv6 アドレスをドメイン名に関連づけるために使用されるレコードである。
- CNAME
  ドメイン名の別名を作成するために使用される。www.example.comとexample.comは同じものを指すことが多くこういった際に使用される。
- MX
  メールサーバを指定するために使用される。ドメインに関連するメールサーバーのホスト名を指定する。
- TXT
  何らかのドメインに関連するテキスト情報をセットすることができる。そして今は SPF、DKIM、DMARC などに使用している。
  https://www.cloudflare.com/ja-jp/learning/dns/dns-records/dns-txt-record/　これを後でよめ。
  スパムメールはメールの送信元を偽装したり、偽造したりされたメールのこと。
- PTR
  IP アドレス逆引き用に使用されている。

6. TTLとは
Time to Liveと言われ、DNSサーバから取得したレコードをフルサービスリゾルば(キャッシュDNSサーバ)がキャッシュしている時間を指しており、
レコード単位で設定することが可能である。DNSのパフォーマンス向上、高速に負荷をかけない名前位解決を行うことが可能となっている。

7. DV、OV、EVの違いは？ACMはどれに該当するか。