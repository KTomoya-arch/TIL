# Linux の教科書学習

Chapter9 まで、ComputeEngine に CentOS を入れて実施ずみ

## プロセスとは？

Linux で様々なコマンドがあったがコマンドの実態は Linux の Disk に保存されているファイルである。シェルからコマンドを実行すると、Linux カーネルは Disk から実行ファイルを読み出してメモリへ格納し、そのメモリ内容に従って CPU がプログラムを実行している。そのメモリ上で実行状態にあるプログラムのことをまさに**プロセス**という。(Linux カーネルからみた処理の単位を指す。)

プロセスは同一のコマンドが実行されても、別々のメモリ領域を持っている。

ls コマンドが 3 つ同時に実行されてもそれら 3 つのプロセスが内部に持つデータが互いに混ざるということはない。

これは Linux カーネルが 1 つ 1 つのプロセスにプロセス ID という一意の番号を割り振り、Linux カーネルがそれらを管理している。

<ローカル PC で実行した例>

```jsx
$ ps

28904 ttys000    0:00.12 /bin/zsh -il
28911 ttys001    0:00.08 /bin/zsh -il
28942 ttys002    0:00.08 /bin/zsh -il
28991 ttys003    0:00.01 /bin/zsh -il
28994 ttys004    0:00.08 /bin/zsh -il
29064 ttys005    0:00.00 /bin/zsh -il
29138 ttys006    0:00.00 /bin/zsh -il
29176 ttys007    0:00.00 /bin/zsh -il
```

また Linux でプロセスが新しく作られるときは無から作られるのではなく、すでに存在している別プロセスを元に作成されるモデルになっている。これを親子関係で表現し、作成するプロセスを親プロセス、作成されるプロセスを子プロセスという。シェルで ls コマンドを実行する場合、シェルが親プロセス、ls コマンドのプロセスが子プロセスに相当する。プロセス ID(PID)はプロセスが起動して終了するまで変化しないため、PID でプロセスを特定することが可能である。

自分のプロセスだけでなく、システムで動いているすべてのプロセスを表示するには a オプションを付加する。

```jsx
ps ax
```

上記をまとめると、Linux 環境ではマルチタスク機能によって様々なプロセスが同時に動作しているということがわかる。

## ジョブ

プロセスは Linux カーネルからみた処理の単位である。一方でシェルからみた処理の単位をジョブという。(どういうこと？全然違いがわからん。)シェルのコマンドラインに入力されている 1 つの行が 1 つのジョブに相当するようだ。つまり、コマンドを 1 つだけ実行するような場合はプロセスとジョブは 1:1 の関係になる。コマンドをパイプ(|)で繋いだような場合には繋いだ分のコマンド数がプロセス数にはなるがそれに対してジョブは 1 となる。

下記は３プロセス、1 ジョブとなる。

```jsx
$ ls -l / | cat -n | less
```

シェルの機能を用いると、ジョブを一時停止させたり、バックグラウンドで実行させたりといったジョブ制御が可能となる。

### コマンドを一時停止する

Ctrl + z でジョブの停止が可能である。

jobs コマンドでジョブの一覧を確認可能である。

#### fg コマンド ジョブをフォアグラウンドにする

一旦停止したジョブを再度確認したい(ユーザーが対話的に操作できる状態に戻したい)場合は下記のコマンドを実行する。そのような状態をフォアグラウンドと呼び、フォアグラウンドにするともいう。

```jsx
$ fg %<ジョブ番号>
```

```jsx
下記の　+　はカレントジョブを指している。
fgでジョブ番号を指定しない場合は、+のカレントジョブへ戻る。

~ ❯❯❯ jobs                                                                                                                                                 ✘ 146
[1]  + suspended  man bash
[2]  - suspended  man bash
```

## ジョブをバックグラウンドにする

Ctrl + z でジョブを停止するとそのジョブは動作を止めてしまう。このために cp file1 file2 とやった直後などに Ctrl + z を実行するとコピー処理は停止してしまい、いつまで経っても完了しないといったことなどが発生する。

このような場合に処理を続行したままシェルへ戻るようにコマンドを実行できると便利である。ユーザーが対話的に操作できないジョブの状態をバックグラウンドと呼ぶ。ジョブをバックグラウンドにするには 下記を実行する。

```jsx
$ bg %<ジョブ番号>
```

わざわざ bg コマンドを使用せずとも、下記でそもそもバックグラウンド実行が可能となる。

```jsx
$ cp file1 file2 &
```
